{{ $content_type := .Params.content_type }}
{{if $content_type}}
{{ $t := .Site.GetPage $content_type }}
{{ $rscPages := $t.Resources.ByType "page"}}

{{if gt (len $rscPages) 0}}
<div class="mt-3"></div>
{{ range $page := $rscPages}}
<div class="publication row w-100 mb-4">
    {{/* This single column will contain all the content and ensure it stacks vertically */}}
    <div class="col">

        <div class="section-1 w-100">
            <a class="link_color" href="{{$page.Params.publication_link}}">
                {{$page.Params.title}},
            </a>
            <span>
                {{$page.Params.publication | markdownify}}, {{substr ($page.Params.date.Format "2006-01-02") 0 4}}.
            </span>
        </div>

        <div class="section-2 text-muted w-100">
            <!-- {{ $authors := $page.Params.authors }}
            {{ if $authors }}
            {{range $i, $author := $authors}}
            <span>{{$author}}</span>{{ if lt $i (sub (len $authors) 1)}}<span class="separator">, </span>{{end}}
            {{end}}
            {{end}} -->
            {{ $authors := $page.Params.authors }}
            {{ if $authors }}
            {{/* --- Start of updated logic --- */}}
            {{range $i, $author := $authors}}
                {{- if strings.HasPrefix $author "Simon Greenhill" -}}
                    <span class="me">{{$author}}</span>
                {{- else -}}
                    <span>{{$author}}</span>
                {{- end -}}
                {{- if lt $i (sub (len $authors) 1) -}}
                    <span class="separator">, </span>
                {{- end -}}
            {{end}}
            {{/* --- End of updated logic --- */}}
            {{end}}
        </div>

        {{ $links := $page.Params.links }}
        {{ if $links }}
        <div class="section-3 text-muted w-100">
            Links: {{range $link_name, $link_url := $links}}
                {{ if $link_url }}
            <a class="main_color text-decoration-none rounded" href="{{$link_url}}" target="_blank">
                {{ $link_name := $link_name | title }}
                {{ $link_name_length := len $link_name }}
                {{ $link_name_sub := substr $link_name 4 $link_name_length }}
                 {{ $link_name_sub }}
            </a>
                {{end}}
            {{end}}
        </div>
        {{end}}

        {{ $media := $page.Params.media }}
        {{ if $media }}
        <div class="section-3 text-muted w-100">
            Selected media coverage:Â 
            {{- range $i, $item := $media -}}
                <a class="main_color text-decoration-none rounded" href="{{ $item.url }}" target="_blank">{{ $item.name | default "Link" }}</a>{{- if ne $i (sub (len $media) 1) -}}, {{ end -}}
            {{- end -}}
        </div>
        {{ end }}

    </div> {{/* End of the new .col div */}}
</div>
{{end}}
{{end}}
{{end}}