{{ $content_type := .Params.content_type }}
{{if $content_type}}
{{ $t := .Site.GetPage $content_type }}
{{ $rscPages := $t.Resources.ByType "page"}}

{{if gt (len $rscPages) 0}}
<div class="projects row w-100">
    <div class="col w-100">
        {{ range $page := $rscPages}}
        <div class="project row  w-100">

            {{/* --- Start of updated title section --- */}}
            {{if $page.Params.publication}}
                <div class="section-1 w-100">
                    {{ if $page.Params.project_link -}}
                        <a class="link_color" href="{{ $page.Params.project_link }}">{{ $page.Params.title }}</a>
                    {{- else -}}
                        {{ $page.Params.title }}
                    {{- end }} ({{$page.Params.status | markdownify}}<span class='italic'> {{$page.Params.publication}}</span>).
                </div>
                <div></div>
            {{else}}
                <div class="section-1 w-100">
                    {{ if $page.Params.project_link -}}
                        <a class="link_color" href="{{ $page.Params.project_link }}">{{ $page.Params.title }}</a>
                    {{- else -}}
                        {{ $page.Params.title }}
                    {{- end }}
                </div>
                <div></div>
            {{end}}
            {{/* --- End of updated title section --- */}}


            <div class="section-2 text-muted w-100">
                {{ $authors := $page.Params.authors }}
                {{ if $authors }}
                {{/* --- Start of updated logic --- */}}
                {{range $i, $author := $authors}}
                    {{- if strings.HasPrefix $author "Simon Greenhill" -}}
                        <span class="me">{{$author}}</span>
                    {{- else -}}
                        <span>{{$author}}</span>
                    {{- end -}}
                    {{- if lt $i (sub (len $authors) 1) -}}
                        <span class="separator">, </span>
                    {{- end -}}
                {{end}}
                {{/* --- End of updated logic --- */}}
                {{end}}
            </div>

            {{ $links := $page.Params.links }}
        {{ if $links }}
        <div class="section-3 text-muted w-100">
            Links: {{range $link_name, $link_url := $links}}
                {{ if $link_url }}
            <a class="main_color text-decoration-none rounded" href="{{$link_url}}" target="_blank">
                {{ $link_name := $link_name | title }}
                {{ $link_name_length := len $link_name }}
                {{ $link_name_sub := substr $link_name 4 $link_name_length }}
                 {{ $link_name_sub | }}
            </a>
                {{end}}
            {{end}}
        </div>
        {{end}}

            {{ $media := $page.Params.media }}
            {{ if $media }}
            <div class="w-100">
                Selected media coverage: {{range $media_name, $media_url := $media}}
                    {{ if $media_url }}
                <a class="link_color" href="{{$media_url}}" target="_blank">
                    {{$media_name | title}}
                </a>
                    {{end}}
                {{end}}
            </div>
            {{end}}

            {{ with $page.Params.abstract }}
            <details class="w-100 mt-2">
                <summary class="cursor-pointer">Abstract</summary>
                <div class="mt-2">
                {{ . | markdownify }}
                </div>
            </details>
            {{ end }}


        </div>

        {{end}}

    </div>
    {{end}}
</div>
{{end}}